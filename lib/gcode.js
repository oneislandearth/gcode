"use strict";exports.__esModule=true;exports.GCode=void 0;class GCode{constructor({name,start,finish,unit,positioning,feedrate,clearance,lines}){this.code=[];this.line=lines==false?0:1;this.name=name?name.toUpperCase():`00${(Math.random()*1000).toFixed(0)}`.slice(-3);this.unit=unit?unit.toLowercase():"cm";this.positioning=positioning?positioning:0;this.clearance=clearance?clearance:10;this.feedrate=feedrate?feedrate:50;this.start=start?start:[0,0,clearance];this.finish=finish?finish:[0,0,clearance];this.state=0;this.initialize()}initialize(){this.add(`%`);this.add(this.opCode(`O`,this.name));this.add(this.opCode(`G`,this.unit=="inch"||this.unit=="in"?"20":"21"));this.setPositioning(this.positioning);this.toggleState();this.raiseMill();this.feedRapid(this.start,this.feedrate)}setPositioning(positioning){positioning=String(positioning).toLowerCase();positioning=positioning=="absolute"?0:positioning=="relative"?1:Number(positioning);this.add(this.opCode(`G`,positioning?`90`:`91`))}scale(number){if(this.unit=="cm")return number*10;if(this.unit=="dm")return number*100;if(this.unit=="m")return number*1000;return number}positionCode(position=[0,0,0]){const positions=[];if(Array.isArray(position))position={x:position[0],y:position[1],z:position[2]};if(position.x!==undefined)positions.push(`X${this.scale(position.x)}`);if(position.y!==undefined)positions.push(`Y${this.scale(position.y)}`);if(position.z!==undefined)positions.push(`Z${this.scale(position.z)}`);return positions.join(` `)}opCode(opt,code){return`${opt}${code}`}feedrateCode(feedrate=50){return this.opCode(`F`,this.scale(feedrate))}dropMill(depth=0){this.feedRapid({z:depth})}raiseMill(depth=this.clearance){this.feedRapid({z:depth})}startSpindle(clockwise=true){this.add(this.opCode(`M`,clockwise?`03`:`04`))}stopSpindle(){this.add(this.opCode(`M`,`05`))}startCoolant(flood=false){this.add(this.opCode(`M`,flood?`08`:`07`))}stopCoolant(){this.add(this.opCode(`M`,`09`))}motion(code,position,feedrate){this.add(`${this.opCode(`G`,code)} ${this.positionCode(position)} ${this.feedrateCode(feedrate)}`)}feedRapid(position,feedrate){this.motion(`00`,position,feedrate)}feedLinear(position,feedrate){this.motion(`01`,position,feedrate)}terminate(force=false){if(!force){this.stopSpindle();this.stopCoolant();this.raiseMill()}this.add(this.opCode(`M`,force?`00`:`30`));this.toggleState()}toggleState(){this.state=!this.state}add(code){if(this.line&&code.charAt(0)!=`%`&&code.charAt(0)!=`O`){code=`${this.opCode(`N`,`00${this.line}`.slice(-3))} ${code}`;this.line++}this.code.push(code)}eval(){if(this.state==1)this.terminate();this.add(`%`);return this.code.join(`\n`)}toString(){return this.eval()}}exports.GCode=GCode;
//# sourceMappingURL=gcode.js.map